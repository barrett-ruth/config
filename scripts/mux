#!/bin/sh

attach_or_restore() {
    [ "$(pgrep tmux)" ] || cmd='start\; run ~/.config/tmux/tmux-resurrect/scripts/restore.sh\; '

    eval "tmux $cmd"a 2>/dev/null || tmux
}

[ "$1" ] || attach_or_restore

case "$1" in
bar)
    bar="$(tmux ls -F '#S' | nl -w1 -v0 -s ':' | paste -sd '-' - | sed "s/$2/$2*/;s/-/  /g")"
    echo "$bar"
    ;;
git)
    [ "$(tmux lsw -F '#W' | rg 'git')" ] && tmux send 'C-c'\; killw -t git
    tmux neww -c '#{pane_current_path}' -n git 'nvim -c "Git|only"'
    ;;
run)
    [ "$(tmux lsw -F '#W' | rg run)" ] && tmux send 'C-c'\; killw -t run

    tmux neww -dc '#{pane_current_path}' -n run \; selectw -t run\; send 'C-l' 'mux-run' 'enter'
    ;;
switch)
    mux-switch "$2"
    ;;
esac
